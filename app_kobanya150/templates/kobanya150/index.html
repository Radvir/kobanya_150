{% extends 'base_generic.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ title }}</h1>
    
    {% if user.is_authenticated %}
        <p>Üdvözöljük, {{ user.username }}!</p>
    {% else %}
        <p><a href="{% url 'login' %}">Bejelentkezés</a> a jelentkezéshez</p>
    {% endif %}
    <div class="alkalom-list">
        
        {% if jogosult_e %}
            <form action="tablazat/" method="post">
                {% csrf_token %}
                <input type="hidden" name="tablazat">
                <button type="submit" class="btn btn-primary">Táblázatok lekérdezése</button>
            </form>        
        {% endif %}

        <h2>Jelenlegi Időszak</h2>
        
        {% if mai_datum < idoszak.kezdoDatum %} 
        <p>Még nem kezdődött el a jelentkezési szakasz.</p>
        {% endif %}
        {% if idoszak.vegDatum < mai_datum %}
        <p>Már lejárt a jelentkezési szakasz.</p>
        {% endif %}
        {% if idoszak.kezdoDatum <= mai_datum and mai_datum <= idoszak.vegDatum%}
        <p>Most lehet jelentkezni</p>
        {% else %}
        
        <p>Most nem lehet jelentkezni</p>
        {% endif %}

        {% for alkalom in alkalmak %}
            <div class="alkalom-item">
                <p><strong>Dátum:</strong> {{ alkalom.datum }}</p>
                <p>{{alkalom.ido_kezdes}}-{{alkalom.ido_vege}}</p>
                <p><strong>Jelentkezők száma:</strong> {{ alkalom.jelentkezok.count }}/{{ alkalom.max_letszam }}</p>
                {% if is_in_any %}
                    {% if user in alkalom.jelentkezok.all %}
                        {% if idoszak.kezdoDatum <= mai_datum and mai_datum <= idoszak.vegDatum%}
            
                            <form action="lejelentkezes/{{alkalom.id}}/" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="alkalom_id" value="{{ alkalom.id }}">
                                <button type="submit" class="btn btn-primary btn-lejelentkezes">Lejelentkezés</button>
                            </form>
                        {% else %}
                            <p></p>
                        {% endif %}
                    
                    {% else %}

                    {% if idoszak.kezdoDatum <= mai_datum and mai_datum <= idoszak.vegDatum%}
                        {% if alkalom.jelentkezok.count < alkalom.max_letszam %}
                            <form action="atjelentkezes/{{alkalom.id}}/" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="alkalom_id" value="{{ alkalom.id }}">
                                <button type="submit" class="btn btn-primary btn-atjelentkezes">Átjelentkezés</button>
                            </form>
                        {% else %}
                            <span class="full">Ez az alkalom betelt</span>
                        {% endif %}
                        
                        {% else %}
                        <p></p>
                        {% endif %}
                    {% endif %}
                    
                    {% else %}
                        {% if idoszak.kezdoDatum <= mai_datum and mai_datum <= idoszak.vegDatum%}

                            {% if alkalom.jelentkezok.count < alkalom.max_letszam %}
                                <!--Feljelentkezés-->    
                                <form action="feljelentkezes/{{alkalom.id}}/" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="alkalom_id" value="{{ alkalom.id }}">
                                    <button type="submit" class="btn btn-primary btn-feljelentkezes">Feljelentkezés</button>
                                </form>
                            {% else %}
                                <span class="full">Ez az alkalom betelt</span>
                            {% endif %} 
                            
                            {% else %}
                            <p></p>
                        
                        {% endif %}
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>

<style>
* {
    margin: 0 !important;
    padding: 0;
}

.full {
    color: #8d8d8dff;
    font-style: italic;
    font-size: 0.8em;
    width: 100%;
    display: flex;
    justify-content: center;
    user-select: none;
}

.alkalom-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.alkalom-item {
    border: 2px solid #ddd;
    padding: 30px;
    margin: 10px 0;
    border-radius: 5px;

}

button a:hover{
    color: white;
}

.alkalom-item a{
    align-self: center;
}

.btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 15px 5px 0 5px !important;
    text-decoration: none;
    border-radius: 4px;
    color: white;
}

.btn-primary {
    background-color: #007bff;
}

.btn-warning {
    background-color: #ffc107;
    color: black;
}

.btn-feljelentkezes {
    background-color: #007bff;
}

.btn-lejelentkezes {
    background-color: #dc3545;
}

.btn-atjelentkezes {
    background-color: #28a745;
}
</style>
{% endblock %}